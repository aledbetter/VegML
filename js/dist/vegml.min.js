!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.veg=e():t.veg=e()}(self,(function(){return(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{VAccum:()=>_,VContext:()=>d,VDataPlane:()=>h,VDataSets:()=>D,VFrame:()=>C,VResultSet:()=>A,ValProb:()=>u,VegCallOut:()=>U,VegEmpty:()=>m,VegFramer:()=>s,VegML:()=>w,VegTest:()=>r,VegTrain:()=>i,VegVtoV:()=>n});var n={};t.r(n),t.d(n,{toVector:()=>k,toVectorObj:()=>L,vectSetGen:()=>O});var r={};t.r(r),t.d(r,{getValPList:()=>Q,getValPListAmp:()=>X,predict:()=>J,predictSets:()=>K});var i={};function a(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}t.r(i),t.d(i,{trainFocus:()=>lt});var u=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),o(this,"value",0),o(this,"prob",0),o(this,"type",-1)}var e,n,r;return e=t,r=[{key:"indexOf",value:function(t,e){if(!t)return-1;for(var n=0;n<t.size();n++)if(t.get(n).value==e)return n;return-1}},{key:"find",value:function(t,e){if(!t)return null;for(var n=0;n<t.size();n++)if(t.get(n).value==e)return t.get(n);return null}}],(n=[{key:"clear",value:function(){value=0,prob=0,type=-1}},{key:"copyFrom",value:function(t){return t.value=this.value,t.prob=this.prob,t.type=this.type,t}},{key:"copy",value:function(){return copyFrom(new t)}}])&&a(e.prototype,n),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}();function l(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var s=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,n;return e=t,n=[{key:"frameToken",value:function(t,e,n,r,i,a,o){return e.setFrame(t.vML.defDP,r,i),!0}},{key:"frameChar",value:function(t,e,n,r,i,a,o){return!0}},{key:"makeFrameSetup",value:function(t,e,n,r,i,a,o){return e.clear(t.vML.defDP),e.setDataSet(r,i,o),t.vML.defDP.framer(t,e,n,r,i,a,o)}}],null&&l(e.prototype,null),n&&l(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function c(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var h=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),f(this,"dtag","-"),f(this,"dptag","-"),f(this,"window",0),f(this,"before",0),f(this,"strMapId",-1),f(this,"noEmpty",!0),f(this,"noEmptyExcept",!0),f(this,"probMethod","Average"),f(this,"framer",null),f(this,"scratchPad",null),f(this,"dac",null),f(this,"nsh",new Array),f(this,"numSets",new Array),f(this,"numSetTiers",new Array),f(this,"nsWeights",null),f(this,"nsTypes",null),f(this,"nsFull",-1),f(this,"nsIdentity",-1),f(this,"identityOnly",!0),f(this,"nsWeightBase","Natural"),f(this,"mappedExceptVectNum",-1),f(this,"noEmptyElementExcept",!0),f(this,"vectIdentity",-1),f(this,"vectFull",-1),f(this,"vectExcept",-1),f(this,"vectPosition",null),f(this,"vectLen",null),f(this,"vectMap",null),f(this,"probSets",null),f(this,"valSets",null),f(this,"groupSets",null),f(this,"vegML",null),this.dtag=e.dtag,this.dptag=e.tag,this.scratchPad=e.scratchPad,this.window=e.window,this.before=e.before,this.strMapId=e.strMapId,this.probMethod=e.probMethod,this.identityOnly=e.identityOnly,this.noEmpty=e.noEmpty,this.noEmptyExcept=e.noEmptyExcept,this.nsFull=e.nsFull,this.nsIdentity=e.nsIdentity,this.dac=new Map(e.dac),this.framer=s.frameToken,"token"==e.framer?this.framer=s.frameToken:"char"==e.framer&&(this.framer=s.frameChar),this.nsWeightBase=e.nsWeightBase,this.nsWeights=e.nsWeights,this.nsTypes=e.nsTypes,this.vectPosition=e.vectPosition,this.vectLen=e.vectLen,this.vectMap=e.vectMap,this.vectIdentity=e.vectIdentity,this.vectFull=e.vectFull,this.vectExcept=e.vectExcept;for(var n=0;n<e.nsh.length;n++){var r=new Map(e.nsh[n].vids);this.nsh.push(r),this.numSets.push(e.nsh[n].numSets)}this.probSets=e.probSets,this.valSets=e.valSets,this.groupSets=e.groupSets;for(var i=0;i<this.groupSets.length;i++)this.groupSets[i][0]}var e,n;return e=t,(n=[{key:"getTag",value:function(){return this.dptag}},{key:"getDimensionTag",value:function(){return this.dtag}},{key:"getVegML",value:function(){return this.vegML}},{key:"isSolid",value:function(){return null!=probSets}},{key:"isCfgNSContext",value:function(t){return 0==this.nsTypes[t]}},{key:"getCfgFrameFocus",value:function(){return this.before}},{key:"isCfgFameFocusNone",value:function(){return defaultNoFocus}},{key:"getCfgWindowSize",value:function(){return this.window}},{key:"getCfgBefore",value:function(){return this.before}},{key:"getCfgAfter",value:function(){return this.window-this.before}},{key:"isCfgIdentityOnly",value:function(){return identityOnly}},{key:"getExceptVectNumber",value:function(){return mappedExceptVectNum}},{key:"isNoEmptyElementsExcept",value:function(){return noEmptyElementExcept}},{key:"getMapVectorNumberSet",value:function(t){return this.vectMap[t][0]}},{key:"getMappedVectorCount",value:function(){return this.vectLen.length}}])&&c(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function p(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var y=10,d=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),p(this,"vML",null),p(this,"id",0),p(this,"callThrough",null),p(this,"tests",null),p(this,"test",-1),this.vML=e,this.id=y++}var e,n;return e=t,(n=[{key:"getId",value:function(){return id}},{key:"getIdString",value:function(){return id+""}},{key:"getVegML",value:function(){return vML}},{key:"getModTests",value:function(){return tests}},{key:"setModTests",value:function(t){this.tests=t}},{key:"getModTest",value:function(){return test}},{key:"setModTest",value:function(t){this.test=t}},{key:"addCallout",value:function(t,e){var n=t+"/"+e;if(null==callThrough)callThrough=new Set;else if(callThrough.has(n))return!1;return callThrough.add(n),!0}},{key:"removeCallout",value:function(t,e){null!=callThrough&&callThrough.delete(t+"/"+e)}}])&&v(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function b(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var m=0,w=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),b(this,"dataPlans",new Map),b(this,"defDP",null),b(this,"defSM",null),b(this,"scratchPad",null),b(this,"stringMapReg",null),b(this,"stringMaps",null),b(this,"empty",0),b(this,"tag","defult"),b(this,"desc","--"),b(this,"nsh",null),b(this,"numSets",null),b(this,"numSetTiers",null),b(this,"inCount",0),this.tag=e.tag,this.desc=e.desc,this.empty=e.empty,m=e.empty,this.scratchPad=e.scratchPad,this.stringMapReg=e.stringMap.reg.stringMapReg,this.stringMaps=new Map;for(var n=0;n<e.stringMap.maps.length;n++){var r=new Map(e.stringMap.maps[n].map);this.stringMaps.set(e.stringMap.maps[n].id,r)}for(var i=this.scratchPad.inf_default_dptag,a=this.scratchPad.inf_default_dtag,o=0;o<e.dataPlans.length;o++){var u=e.dataPlans[o],l=new h(u);this.dataPlans.set(u.dtag+"/"+u.tag,l),l.dtag==a&&l.dptag==i&&(this.defDP=l,this.defSM=this.stringMaps.get(l.strMapId),console.log(" defaultDP["+a+"/"+i+"] w["+l.window+"]ns["+l.nsh.length+"] strMapId["+l.strMapId+"]"))}}var e,n,r;return e=t,r=[{key:"load",value:function(e){fetch(e,{mode:"cors"}).then((function(t){return t.json()})).then((function(e){console.log("loading RPM: "+e.tag),vML=new t(e)}))}}],(n=[{key:"addStringMapping",value:function(t){return this.defSM.get(t)}},{key:"getInCount",value:function(){return inCount}},{key:"setInCount",value:function(t){this.inCount=t}},{key:"incCount",value:function(){inCount++}}])&&g(e.prototype,n),r&&g(e,r),Object.defineProperty(e,"prototype",{writable:!1}),t}(),S=59n,P=37n,M=1125899906842597n;function k(t){if(null==t||0==t.length)return m;if(2==t.length){var e=1003+t.charCodeAt(0);return 59*(e=59*(e=59*e+"~".charCodeAt(0))+" ".charCodeAt(0))+t.charCodeAt(1)}return E(t)}function L(t){return null==t?m:t instanceof String?k(t):E(t.toString())}function O(t,e,n,r,i,a){for(var o=0;o<r.length;o++)r[o]=BigInt(-1);for(var u=0;u<t[0].length;u++)for(var l=0;l<e.length;l++)if(!(e[l]<1)&&t[l][u][0]&&(i&&l!=a&&n[0][u]==m&&(r[l]=-2),-2!=r[l]))if(t[l][u].length>1)for(var s=1;s<t[l][u].length;s++){var c=s-1;if(t[l][u][s]&&n[c][u]==m&&i&&l!=a){r[l]=-2;break}t[l][u][s]?r[l]=I(e[l],n[c][u],r[l]):r[l]=I(e[l],1975,r[l])}else r[l]=I(e[l],n[0][u],r[l])}function I(t,e,n){return 1==t?e:2==t?-1==n?BigInt.asUintN(32,BigInt(e)*P):BigInt.asIntN(64,BigInt(e)<<32n|n):(-1==n&&(n=0),n=function(t,e){for(0==t&&(t=M),e<0&&(t=S*t+45n,e=-e);e>0;)t=BigInt.asIntN(64,S*t+BigInt(e%10+48)),e=Math.floor(e/10);return t}(n,e))}function E(t){for(var e=17,n=0;n<t.length;n++)e=59*e+t.charCodeAt(n),e&=e;return e}function T(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function j(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var C=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),j(this,"frame",null),j(this,"frameFocus",0),j(this,"tiers",1),j(this,"windowSize",1),j(this,"dataSet",null),j(this,"dataSetObj",null),j(this,"dataSetNumber",0),j(this,"dataSetPosition",0),j(this,"vectSpace",null),j(this,"setIds",null),j(this,"vpList",null)}var e,n;return e=t,(n=[{key:"clear",value:function(t){this.frameFocus=0,this.dataSetPosition=-1,this.dataSet=null,this.dataSetObj=null,this.dataSetObjDep=null,this.init(t)}},{key:"init",value:function(t){if(null==this.frame){this.windowSize=t.window,this.frame=[this.tiers];for(var e=0;e<this.tiers;e++){for(var n=new Array,r=0;r<t.window;r++)n.push(0);this.frame[e]=n}this.setIds=new Array,this.vectSpace=new Array;for(var i=0;i<t.getMappedVectorCount();i++)this.setIds.push(-1),this.vectSpace.push(BigInt(-1));this.vpList=new Array}}},{key:"setDataSet",value:function(t,e,n){this.dataSetPosition=e,this.dataSet=t,this.dataSetNumber=n}},{key:"setDataSetObj",value:function(t,e,n){this.dataSetPosition=e,this.dataSetObj=t,this.dataSetNumber=n}},{key:"setValue",value:function(t,e){this.frame[t]=k(e)}},{key:"setValueEmpty",value:function(t){this.frame[t]=m}},{key:"setFrame",value:function(t,e,n){this.init(t),this.dataSet=e,this.frameFocus=t.getFrameFocus(),this.dataSetPosition=n;var r=n-t.getFrameFocus();if(r<0||n+t.getAfter()>=e.length)for(var i=0;i<t.window;i++){var a=null;r+i>=e.length||r+i<0||(a=e[r+i]),this.frame[0][i]=null==a?m:k(a)}else if(n>0&&n==n-1){for(var o=1;o<t.window;o++)this.frame[0][o-1]=this.frame[0][o];var u=n-t.getFrameFocus()+(t.window-1);this.frame[0][t.window-1]=k(e[u])}else for(var l=0;l<t.window;l++){var s=e[n-t.getFrameFocus()+l];this.frame[0][l]=k(s)}}}])&&T(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function V(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function F(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var A=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),F(this,"dp",null),F(this,"responseOut",null),F(this,"total",0),F(this,"failTotal",0),F(this,"passTotal",0),this.dp=e}var e,n;return e=t,(n=[{key:"start",value:function(){}},{key:"end",value:function(){}}])&&V(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function N(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function x(t,e,n){return e&&N(t.prototype,e),n&&N(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var D=x((function t(e){var n,r;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(r="datasets")in(n=this)?Object.defineProperty(n,r,{value:null,enumerable:!0,configurable:!0,writable:!0}):n[r]=null}));function B(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function R(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var _=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),R(this,"total",0),R(this,"values",null)}var e,n;return e=t,(n=[{key:"clear",value:function(){total=0,value=null}},{key:"addValue",value:function(t,e){total+=e}}])&&B(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function W(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function z(t,e,n){return e&&W(t.prototype,e),n&&W(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var U=z((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}));function G(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,a=[],o=!0,u=!1;try{for(n=n.call(t);!(o=(r=n.next()).done)&&(a.push(r.value),!e||a.length!==e);o=!0);}catch(t){u=!0,i=t}finally{try{o||null==n.return||n.return()}finally{if(u)throw i}}return a}}(t,e)||$(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function H(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=$(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,o=!0,u=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){u=!0,a=t},f:function(){try{o||null==n.return||n.return()}finally{if(u)throw a}}}}function $(t,e){if(t){if("string"==typeof t)return q(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?q(t,e):void 0}}function q(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function J(t,e,n,r,i){if(null==t)return null;var a=new Array;return getValProbs(t,e,n,r,i,a),a.length<1?null:t.vML.addStringMapping(a[0][0])}function K(t,e){if(null==e)return null;var n=t.defDP,r=new A(n);r.responseOut=new Array;for(var i=new d(t),a=0;a<e.length;a++){for(var o=e[a],u=new Array,l=new C,c=0;c<o.length;c++)if(s.makeFrameSetup(i,l,u,o,c,o[c],a)){var f=tt(i,l,u,0);r.total++,console.log(" [@"+c+"] > predictType["+f+"] val("+l.vpList.length+")["+l.vpList[0].value+"]["+t.addStringMapping(l.vpList[0].value)+"]")}else u.push(m);r.responseOut.push(u)}return r}function Q(t,e,n,r,i){e.vpList.length=0;var a=function(t,e,n){O(t.vectPosition,t.vectLen,e.frame,e.vectSpace,t.noEmpty,t.vectExcept);var r=Y(t,e),i=3,a=e.setIds[t.vectFull];if(a>=0){i=0;var o=t.valSets[groupSets[a][1]];null!=o&&o.length>1&&(i=1),o[0]}var u=-1,l=null;t.identityOnly&&t.vectIdentity>=0&&((u=e.setIds[t.vectIdentity])>=0?l=t.valSets[t.groupSets[u][1]]:i=4);for(var s=0;s<e.setIds.length;s++)if(!(e.setIds[s]<0)){var c=e.setIds[s],f=-1,h=-1;try{f=t.groupSets[c][1],h=t.groupSets[c][0]}catch(t){}var v=t.probSets[h],p=t.valSets[f];v||console.log("ERROR: NO PROB LIST["+c+"]ns["+s+"] v["+f+"]["+h+"] ["+t.groupSets[c]+"]");for(var y=!1,d=0;d<v.length;d++){var g=p[d];null!=l&&t.identityOnly&&!Z(l,null,g)||(rt(e.vpList,g,v[d]),y=!0)}y&&(t.isNumberSetContext(t.getMapVectorNumberSet(s))||3==i&&s!=t.vectIdentity&&(i=2))}if(e.vpList.length<1){if(n||null==t.dac)return-1;var b,m=H(t.dac);try{for(m.s();!(b=m.n()).done;){var w=G(b.value,2),S=w[0],P=w[1];rt(e.vpList,P,S*DEFAULT_PROB_WEIGHT)}}catch(t){m.e(t)}finally{m.f()}return e.vpList[0].type=5,5}for(var M=0;M<e.vpList.length;M++){var k=e.vpList[M];k.probability=k.probability/r}return e.vpList.sort(nt),e.vpList[0].type=i,i}(t.vML.defDP,e,r);return e.vpList.length>0&&(e.vpList[0].type=a),et(t.vML.defDP.dac,e.vpList),e.vpList.length>0&&null==e.vpList[0].type&&(null==a&&(a=4),e.vpList[0].type=a),null!=n&&(e.vpList.length>0?n.push(e.vpList[0].value):n.push(m)),a}function X(t,e,n,r,i,a,o,u,l,s){e.vpList.length=0;var c=function(t,e,n,r,i,a,o,u){O(t.vectPosition,t.vectLen,e.frame,e.vectSpace,t.noEmpty,t.vectExcept);var l=Y(t,e),s=3,c=e.setIds[t.vectFull];if(c>=0){s=0;var f=t.valSets[groupSets[c][1]];null!=f&&f.length>1&&(s=1),f[0]}var h=-1,v=null;t.identityOnly&&t.vectIdentity>=0&&((h=e.setIds[t.vectIdentity])>=0?v=t.valSets[t.groupSets[h][1]]:s=4);for(var p=0;p<e.setIds.length;p++)if(!(e.setIds[p]<0)){var y=t.getMapVectorNumberSet(p),d=o;t.isNumberSetContext(y)||(d=a);var g=e.setIds[p],b=-1,m=-1;try{b=t.groupSets[g][1],m=t.groupSets[g][0]}catch(t){}var w=t.probSets[m],S=t.valSets[b];w||console.log("ERROR: NO PROB LIST["+g+"]ns["+p+"] v["+b+"]["+m+"] ["+t.groupSets[g]+"]");for(var P=ot(w,S,r,d),M=!1,k=0;k<w.length;k++){var L=w[k],I=S[k];if(!((L=i?at(w,S,k,r,P):it(w,S,k,r,P))<=0)){if(t.nsVectNumIdentity==p&&u>0)L*=u;else if(null!=v&&t.identityOnly&&!Z(v,null,I))continue;rt(e.vpList,I,L),M=!0}}M&&(t.isNumberSetContext(y)||3==s&&p!=t.vectIdentity&&(s=2))}if(e.vpList.length<1){if(n||null==t.dac)return-1;var E,T=H(t.dac);try{for(T.s();!(E=T.n()).done;){var j=G(E.value,2),C=j[0],V=j[1];rt(e.vpList,V,C*DEFAULT_PROB_WEIGHT)}}catch(t){T.e(t)}finally{T.f()}return e.vpList[0].type=5,5}for(var F=0;F<e.vpList.length;F++){var A=e.vpList[F];A.probability=A.probability/l}return e.vpList.sort(nt),e.vpList[0].type=s,s}(t.vML.defDP,e,r,a,o,u,l,s);return e.vpList.length>0&&(e.vpList[0].type=c),et(t.vML.defDP.dac,e.vpList),c}function Y(t,e){for(var n=0,r=0;r<e.vectSpace.length;r++){e.setIds[r]=-1;var i=e.vectSpace[r];if(-2!=i&&-1!=i&&0!=i){var a=t.nsh[r].get(i);!a||a<=0?a=-2:a-=1,e.setIds[r]=a,n++}}return n}function Z(t,e,n){if(null!=t){for(var r=0;r<t.length;r++)if(t[r]==n)return!0}else for(var i=0;i<e.length;i++)if(e[i]==n)return!0;return!1}function tt(t,e,n,r){return function(t,e,n,r,i,a){var o=3;return a||(o=Q(t,e,n,!1)),function(t,e){return!(null==t||t.length<1)&&t[0].value==e}(e.vpList,i)||0==i?o:-1}(t,e,n,0,r,!1)}function et(t,e){if(e.length<2)return e;var n=e[0].type,r=e[0].probability;if(r!=e[1].probability)return e.sort(nt),e[0].type=n,e;for(var i=0,a=0;a<e.length;a++){var o=e[a],u=t.get(o.value),l=o.probability/u;l>i&&(i=l)}for(var s=0;s<e.length;s++){var c=e[s],f=t.get(c.value);if(c.probability=(c.probability+f*i)/2,c.probability!=r)break}return e.sort(nt),e[0].type=n,e}function nt(t,e){return t.probability<e.probability?1:t.probability>e.probability?-1:t.count<e.count?1:t.count>e.count?-1:t.value<e.value?1:t.value>e.value?-1:0}function rt(t,e,n){var r=function(t,e){if(null==t)return-1;for(var n=0;n<t.length;n++)if(t[n].value==e)return n;return-1}(t,e);if(r>=0)t[r].probability+=n;else{var i=new u;i.value=e,i.probability=n,t.push(i)}return t}function it(t,e,n,r,i){return 0==i?t[n]:ut(r,e[n])?t[n]*i:t[n]}function at(t,e,n,r,i){return ut(r,e[n])?0==i?t[n]:t[n]*i:0}function ot(t,e,n,r){if(null==t)return 0;for(var i=0,a=0,o=0,u=0,l=0;l<t.length;l++)o+=t[l],ut(n,e[l])?a+=t[l]:r<=0||u<r?i++:a+=t[l],u++;return 0==i?0:o/a}function ut(t,e){for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1}function lt(t,e,n){return t.getVegML().incCount(),(t.getCfgNonValue()!=n[0]||1!=n.length)&&(O(t.getNSMapVectorPositions(),t.getNSMapVectorLength(),e.getFrameFull(),e.getVectSpace(),t.isNoEmptyElements(),t.getExceptVectNumber()),!0)}return e})()}));